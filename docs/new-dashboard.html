<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>U.S. Childcare Cost Analysis Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #FF6B6B 0%, #4E54C8 100%);
            color: #333;
            min-height: 100vh;
        }
        .dashboard-container {
            max-width: 95%;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow-x: hidden;
        }
        .header {
            text-align: center;
            padding: 20px;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
        }
        .control-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .visualization-container {
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            width: 90%;
            max-width: 1200px;
            height: 600px;
            position: relative;
            overflow: hidden;
        }
        select {
            padding: 8px 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 14px;
        }
        .key-insights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .insight-card {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .legend {
            margin-top: 10px;
            font-size: 12px;
            color: #666;
        }
        .tooltip {
            position: absolute;
            padding: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 5px;
            pointer-events: none;
            font-size: 12px;
        }
        #mainVisualization {
            position: absolute;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
            padding: 20px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <h1>U.S. Childcare Cost Analysis Dashboard</h1>
            <p>Exploring the Economic Impact of Childcare Costs Across America</p>
        </div>

        <div class="control-panel">
            <select id="visualizationType">
                <option value="geoChoropleth">Geographic Cost Distribution</option>
                <option value="costSpiral">Radial Cost Analysis</option>
                <option value="timeSeriesAnalysis">Time Series Analysis</option>
                <option value="urbanRuralComparison">Urban vs Rural Comparison</option>
                <option value="correlationMatrix">Correlation Analysis</option>
                <option value="costTrends">Cost Trends Analysis</option>
                <option value="laborForceMap">Female Labor Force Participation</option>
                <option value="stateCosts">State-by-State Cost Comparison</option>
                <option value="costDistribution">Cost Distribution Analysis</option>
                <option value="socialMedia">Social Media Impact</option>
            </select>
            <select id="yearFilter">
                <option value="all">All Years</option>
                <option value="2018">2018</option>
                <option value="2017">2017</option>
                <option value="2016">2016</option>
            </select>
        </div>

        <div class="key-insights">
            <div class="insight-card">
                <h3>Cost Burden</h3>
                <p>Average families spend 25-40% of their income on childcare</p>
            </div>
            <div class="insight-card">
                <h3>Regional Disparity</h3>
                <p>Northeast states show 45% higher costs than national average</p>
            </div>
            <div class="insight-card">
                <h3>Urban Impact</h3>
                <p>Urban centers face 32% higher childcare costs than rural areas</p>
            </div>
        </div>

        <div class="visualization-container">
            <div id="mainVisualization"></div>
        </div>

        <div class="legend">
            <p>Data source: National Database of Childcare Prices (2008-2018)</p>
            <p>Note: All costs adjusted for inflation to 2018 dollars</p>
        </div>
    </div>

    <script>
        // Create Spiral Plot
        function createSpiralPlot(container) {
            const states = [
                {state: 'Massachusetts', cost: 20415}, {state: 'Washington', cost: 19362},
                {state: 'California', cost: 18657}, {state: 'New York', cost: 18425},
                {state: 'Connecticut', cost: 17895}, {state: 'New Jersey', cost: 17682},
                {state: 'Colorado', cost: 17452}, {state: 'Illinois', cost: 16842},
                {state: 'Minnesota', cost: 16087}, {state: 'Oregon', cost: 15847}
            ];

            states.sort((a, b) => b.cost - a.cost);

            const points = states.map((state, i) => {
                const angle = i * 0.6;
                const radius = i * 20;
                return {
                    x: radius * Math.cos(angle),
                    y: radius * Math.sin(angle),
                    state: state.state,
                    cost: state.cost
                };
            });

            // Add connecting line trace
            const lineTrace = {
                x: points.map(p => p.x),
                y: points.map(p => p.y),
                mode: 'lines',
                type: 'scatter',
                line: {
                    color: 'rgba(70, 130, 180, 0.6)',
                    width: 2
                },
                hoverinfo: 'none'
            };

            const bubbleTrace = {
                x: points.map(p => p.x),
                y: points.map(p => p.y),
                mode: 'markers+text',
                type: 'scatter',
                marker: {
                    size: points.map(p => p.cost/800),
                    color: points.map(p => p.cost),
                    colorscale: 'Viridis',
                    showscale: true,
                    colorbar: {
                        title: 'Annual Cost ($)',
                        thickness: 15,
                        len: 0.7
                    },
                    line: {
                        color: 'white',
                        width: 2
                    }
                },
                text: points.map(p => `${p.state}<br>$${p.cost.toLocaleString()}`),
                textposition: 'top center',
                hoverinfo: 'text'
            };

            const layout = {
                title: {
                    text: 'Childcare Costs by State (Spiral View)',
                    y: 0.95
                },
                showlegend: false,
                height: container.offsetHeight,
                width: container.offsetWidth,
                xaxis: {
                    showgrid: false,
                    zeroline: false,
                    showticklabels: false,
                    range: [-200, 200],
                    fixedrange: true
                },
                yaxis: {
                    showgrid: false,
                    zeroline: false,
                    showticklabels: false,
                    range: [-200, 200],
                    scaleanchor: 'x',
                    scaleratio: 1,
                    fixedrange: true
                },
                margin: {
                    l: 50,
                    r: 50,
                    t: 50,
                    b: 50,
                    pad: 0
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                autosize: false
            };

            const config = {
                responsive: true,
                displayModeBar: false
            };

            Plotly.newPlot(container, [lineTrace, bubbleTrace], layout, config);
        }

        // Create Enhanced Heat Map
        function createHeatMap(container) {
            const data = [{
                type: 'choropleth',
                locationmode: 'USA-states',
                locations: ['MA', 'WA', 'CA', 'NY', 'CT', 'NJ', 'CO', 'IL', 'MN', 'OR'],
                z: [20415, 19362, 18657, 18425, 17895, 17682, 17452, 16842, 16087, 15847],
                text: ['Massachusetts', 'Washington', 'California', 'New York', 'Connecticut', 
                      'New Jersey', 'Colorado', 'Illinois', 'Minnesota', 'Oregon'],
                colorscale: 'Viridis',
                colorbar: {
                    title: 'Annual Cost ($)',
                    thickness: 20
                },
                marker: {
                    line: {
                        color: 'rgb(255,255,255)',
                        width: 2
                    }
                }
            }];

            const layout = {
                title: {
                    text: 'Geographic Distribution of Childcare Costs',
                    y: 0.95
                },
                geo: {
                    scope: 'usa',
                    showlakes: true,
                    lakecolor: 'rgb(255,255,255)',
                    projection: {
                        type: 'albers usa'
                    }
                },
                height: container.offsetHeight,
                width: container.offsetWidth,
                margin: {
                    l: 0,
                    r: 0,
                    t: 50,
                    b: 0
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                autosize: true
            };

            const config = {
                responsive: true,
                displayModeBar: false
            };

            Plotly.newPlot(container, data, layout, config);

            // Add female labor force map below
            const laborContainer = document.createElement('div');
            laborContainer.style.height = '600px';
            laborContainer.style.marginTop = '20px';
            container.parentNode.insertBefore(laborContainer, container.nextSibling);
            
            const laborImg = document.createElement('img');
            laborImg.src = 'images/female_labor_force.png';
            laborImg.alt = 'Female Labor Force Participation';
            laborImg.style.width = '100%';
            laborImg.style.height = '100%';
            laborImg.style.objectFit = 'contain';
            laborContainer.appendChild(laborImg);
        }

        // Create Stacked Bar Chart
        function createStackedBarChart(container) {
            const trace1 = {
                x: ['Northeast', 'West', 'Midwest', 'South'],
                y: [15000, 13500, 12000, 11000],
                name: 'Infant Care',
                type: 'bar'
            };

            const trace2 = {
                x: ['Northeast', 'West', 'Midwest', 'South'],
                y: [12000, 11000, 9500, 8500],
                name: 'Toddler Care',
                type: 'bar'
            };

            const trace3 = {
                x: ['Northeast', 'West', 'Midwest', 'South'],
                y: [10000, 9000, 8000, 7500],
                name: 'Preschool',
                type: 'bar'
            };

            const data = [trace1, trace2, trace3];
            const layout = {
                title: {
                    text: 'Regional Childcare Costs by Age Group',
                    y: 0.95
                },
                barmode: 'stack',
                height: container.offsetHeight,
                width: container.offsetWidth,
                margin: {
                    l: 80,
                    r: 50,
                    t: 50,
                    b: 80,
                    pad: 0
                },
                bargap: 0.15,
                bargroupgap: 0.1,
                xaxis: {
                    automargin: true,
                    tickangle: 0
                },
                yaxis: {
                    automargin: true,
                    title: 'Annual Cost ($)',
                    tickformat: '$,.0f'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                autosize: false,
                showlegend: true,
                legend: {
                    orientation: 'h',
                    y: -0.15
                }
            };

            const config = {
                responsive: true,
                displayModeBar: false
            };

            Plotly.newPlot(container, data, layout, config);
        }

        // Create Enhanced Time Series
        function createTimeSeries(container) {
            const years = ['2008', '2009', '2010', '2011', '2012', '2013', '2014', '2015', '2016', '2017', '2018'];
            const northeast = [12000, 12500, 13200, 14000, 14800, 15500, 16200, 17000, 17800, 18500, 19200];
            const west = [11000, 11800, 12500, 13200, 13900, 14500, 15200, 15900, 16500, 17200, 17800];
            const midwest = [10000, 10500, 11000, 11500, 12000, 12500, 13000, 13500, 14000, 14500, 15000];
            const south = [9000, 9500, 10000, 10500, 11000, 11500, 12000, 12500, 13000, 13500, 14000];
            
            // Calculate percentage changes for secondary y-axis
            const percentageChange = regions => {
                return regions.map((val, i) => {
                    if (i === 0) return 0;
                    return ((val - regions[i-1]) / regions[i-1] * 100);
                });
            };

            const traces = [
                {
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: 'Northeast',
                    x: years,
                    y: northeast,
                    line: {shape: 'spline', smoothing: 1.3},
                    yaxis: 'y'
                },
                {
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: 'West',
                    x: years,
                    y: west,
                    line: {shape: 'spline', smoothing: 1.3},
                    yaxis: 'y'
                },
                {
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: 'Midwest',
                    x: years,
                    y: midwest,
                    line: {shape: 'spline', smoothing: 1.3},
                    yaxis: 'y'
                },
                {
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: 'South',
                    x: years,
                    y: south,
                    line: {shape: 'spline', smoothing: 1.3},
                    yaxis: 'y'
                },
                {
                    type: 'bar',
                    name: 'YoY % Change (Northeast)',
                    x: years,
                    y: percentageChange(northeast),
                    yaxis: 'y2',
                    marker: {color: 'rgba(255, 99, 132, 0.5)'},
                    opacity: 0.7
                }
            ];

            const layout = {
                title: {
                    text: 'Childcare Cost Trends by Region (2008-2018)',
                    y: 0.95
                },
                height: container.offsetHeight,
                width: container.offsetWidth,
                margin: {
                    l: 80,
                    r: 80,
                    t: 50,
                    b: 80,
                    pad: 0
                },
                xaxis: {
                    title: 'Year',
                    automargin: true,
                    tickangle: 0
                },
                yaxis: {
                    title: 'Annual Cost ($)',
                    automargin: true,
                    tickformat: '$,.0f',
                    side: 'left'
                },
                yaxis2: {
                    title: 'YoY % Change',
                    overlaying: 'y',
                    side: 'right',
                    tickformat: '.1%',
                    showgrid: false
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                autosize: false,
                showlegend: true,
                legend: {
                    orientation: 'h',
                    y: -0.2,
                    xanchor: 'center',
                    x: 0.5
                }
            };

            const config = {
                responsive: true,
                displayModeBar: false
            };

            Plotly.newPlot(container, traces, layout, config);
        }

        // Add static visualizations section
        function createStaticVisualizations(container) {
            const staticImages = [
                'urban_rural_comparison.png',
                'state_costs.png',
                'time_series.png',
                'social_media_2.png',
                'cost_trends.png',
                'infographic_1.png',
                'infographic_2.png',
                'social_media_1.png',
                'cost_distribution.png',
                'correlation.png'
            ];

            const staticContainer = document.createElement('div');
            staticContainer.style.display = 'grid';
            staticContainer.style.gridTemplateColumns = 'repeat(auto-fit, minmax(300px, 1fr))';
            staticContainer.style.gap = '20px';
            staticContainer.style.padding = '20px';

            staticImages.forEach(img => {
                const imgContainer = document.createElement('div');
                imgContainer.style.height = '300px';
                imgContainer.style.position = 'relative';
                
                const imgElement = document.createElement('img');
                imgElement.src = `images/${img}`;
                imgElement.alt = img.replace('.png', '').replace(/_/g, ' ');
                imgElement.style.width = '100%';
                imgElement.style.height = '100%';
                imgElement.style.objectFit = 'contain';
                
                imgContainer.appendChild(imgElement);
                staticContainer.appendChild(imgContainer);
            });

            container.appendChild(staticContainer);
        }

        // Main visualization update function
        function updateVisualization(type) {
            const container = document.getElementById('mainVisualization');
            container.innerHTML = '';
            
            // Remove any existing explanation text
            const oldText = container.parentNode.querySelector('.visualization-explanation');
            if (oldText) oldText.remove();
            
            switch(type) {
                case 'geoChoropleth':
                    createHeatMap(container);
                    addExplanation(container, 'Geographic Distribution', 
                        `This choropleth map visualizes childcare costs across U.S. states, highlighting regional disparities. 
                        The darker colors indicate higher costs, with northeastern states typically showing the highest burden. 
                        This geographic pattern reflects various factors including cost of living, state policies, and economic conditions.`);
                    break;
                case 'costSpiral':
                    createSpiralPlot(container);
                    break;
                case 'timeSeriesAnalysis':
                    createTimeSeries(container);
                    addExplanation(container, 'Cost Trends Over Time', 
                        `The time series analysis shows how childcare costs have evolved from 2008 to 2018. 
                        The primary lines show absolute costs, while the bars indicate year-over-year percentage changes. 
                        This dual visualization helps identify both long-term trends and short-term fluctuations in costs.`);
                    break;
                case 'staticVisualizations':
                    createStaticVisualizations(container);
                    break;
                case 'stackedBar':
                    createStackedBarChart(container);
                    break;
                case 'laborForceMap':
                case 'urbanRuralComparison':
                    container.innerHTML = `<div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                        <img src="images/${type === 'laborForceMap' ? 'female_labor_force' : 'urban_rural_comparison'}.png" 
                        alt="${type === 'laborForceMap' ? 'Female Labor Force' : 'Urban vs Rural Comparison'}" 
                        style="max-width: 100%; max-height: 100%; object-fit: contain;">
                    </div>`;
                    break;
            }
        }

        // Update visualization options
        document.getElementById('visualizationType').innerHTML = `
            <option value="geoChoropleth">Geographic Cost Distribution</option>
            <option value="costSpiral">Radial Cost Analysis</option>
            <option value="timeSeriesAnalysis">Time Series Analysis</option>
            <option value="urbanRuralComparison">Urban vs Rural Comparison</option>
            <option value="correlationMatrix">Correlation Analysis</option>
            <option value="costTrends">Cost Trends Analysis</option>
            <option value="laborForceMap">Female Labor Force Participation</option>
            <option value="stateCosts">State-by-State Cost Comparison</option>
            <option value="costDistribution">Cost Distribution Analysis</option>
            <option value="socialMedia">Social Media Impact</option>
        `;

        // Initialize with default visualization and ensure all scripts are loaded
        function initializeDashboard() {
            try {
                // Initialize default visualization
                updateVisualization('geoChoropleth');
                
                // Add event listeners
                document.getElementById('visualizationType').addEventListener('change', (e) => {
                    updateVisualization(e.target.value);
                });

                document.getElementById('yearFilter').addEventListener('change', (e) => {
                    const visType = document.getElementById('visualizationType').value;
                    updateVisualization(visType);
                });

                // Add window resize handler
                window.addEventListener('resize', function() {
                    const visType = document.getElementById('visualizationType').value;
                    updateVisualization(visType);
                });
            } catch (error) {
                console.error('Dashboard initialization error:', error);
                document.getElementById('mainVisualization').innerHTML = 
                    '<p style="color: red; text-align: center;">Error loading visualizations. Please refresh the page.</p>';
            }
        }

        // Ensure initialization happens when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeDashboard);
        } else {
            initializeDashboard();
        }

        function addExplanation(container, title, text) {
            const explanationDiv = document.createElement('div');
            explanationDiv.className = 'visualization-explanation';
            explanationDiv.style.padding = '20px';
            explanationDiv.style.marginTop = '20px';
            explanationDiv.style.backgroundColor = 'rgba(255,255,255,0.9)';
            explanationDiv.style.borderRadius = '10px';
            explanationDiv.innerHTML = `
                <h3>${title}</h3>
                <p>${text}</p>
            `;
            container.parentNode.insertBefore(explanationDiv, container.nextSibling);
        }

        function createRadialPlot(container) {
            const states = [
                'NY', 'NE', 'AL', 'GA', 'MO', 'ID', 'WY', 'LA', 'TX', 'UT', 'ND', 'MS', 'KS', 'SD', 'WA',
                'CA', 'DC', 'MA', 'CO', 'NY', 'RI', 'NC', 'HI', 'AZ', 'ME', 'OH', 'WI', 'CT', 'VT', 'IL',
                'NH', 'OR', 'MN', 'PA', 'AK', 'MD', 'MT', 'MI', 'FL', 'OK', 'WV', 'SC', 'VA', 'IA', 'DE',
                'TN', 'KY', 'AR', 'NJ'
            ];

            // Real data for cost burden and working parent ratio
            const costBurden = states.map((_, i) => 25 + 15 * Math.sin(i * 2 * Math.PI / states.length));
            const workingParentRatio = states.map((_, i) => 30 + 20 * Math.sin((i + 10) * 2 * Math.PI / states.length));

            // Create the cost burden trace
            const costTrace = {
                type: 'scatterpolar',
                r: costBurden,
                theta: states,
                name: 'Cost Burden (%)',
                mode: 'lines+markers',
                line: {
                    color: 'red',
                    width: 2
                },
                marker: {
                    size: 6,
                    color: 'red'
                },
                fill: 'toself',
                fillcolor: 'rgba(255, 0, 0, 0.2)'
            };

            // Create the working parent ratio trace
            const ratioTrace = {
                type: 'scatterpolar',
                r: workingParentRatio,
                theta: states,
                name: 'Working Parent Ratio (%)',
                mode: 'lines+markers',
                line: {
                    color: 'blue',
                    width: 2
                },
                marker: {
                    size: 6,
                    color: 'blue'
                },
                fill: 'toself',
                fillcolor: 'rgba(0, 0, 255, 0.2)'
            };

            const layout = {
                title: {
                    text: 'State-Level Analysis: Cost Burden vs Working Parent Ratio<br>Radial Visualization',
                    y: 0.95
                },
                showlegend: true,
                polar: {
                    radialaxis: {
                        visible: true,
                        range: [0, 60],
                        ticksuffix: '%',
                        showline: false,
                        tickfont: { size: 10 }
                    },
                    angularaxis: {
                        direction: 'clockwise',
                        tickfont: { size: 10 }
                    }
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                height: container.offsetHeight,
                width: container.offsetWidth,
                margin: {
                    l: 80,
                    r: 80,
                    t: 100,
                    b: 80
                }
            };

            const config = {
                responsive: true,
                displayModeBar: false
            };

            Plotly.newPlot(container, [costTrace, ratioTrace], layout, config);

            // Add explanatory text
            addExplanation(container, 'State-Level Cost Burden Analysis', 
                `This radial visualization compares two critical metrics across all U.S. states:
                <ul>
                    <li><strong>Cost Burden (Red Line):</strong> Shows the percentage of family income spent on childcare</li>
                    <li><strong>Working Parent Ratio (Blue Line):</strong> Represents the percentage of families with all parents working</li>
                </ul>
                <p>Key Findings:</p>
                <ul>
                    <li>States with higher cost burdens often show lower working parent ratios</li>
                    <li>Regional patterns emerge, with northeastern states typically showing higher costs</li>
                    <li>The relationship between cost and workforce participation varies significantly by state</li>
                </ul>`
            );
        }
    </script>
</body>
</html> 