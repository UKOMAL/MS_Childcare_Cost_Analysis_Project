<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Test Page</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.1.min.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
        }
        .test-container {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-output {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border: 1px solid #eee;
            border-radius: 5px;
            min-height: 100px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .test-viz {
            height: 300px;
            border: 1px dashed #ccc;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">Dashboard Test Page</h1>
        
        <div class="test-container">
            <h3>Test Dashboard Components</h3>
            <div class="row mb-3">
                <div class="col">
                    <button id="testPlotly" class="btn btn-primary">Test Plotly</button>
                    <button id="testData" class="btn btn-success">Test Data Loading</button>
                    <button id="testAll" class="btn btn-warning">Run All Tests</button>
                </div>
            </div>
            <div class="test-output" id="testOutput">
                Test output will appear here...
            </div>
        </div>
        
        <div class="test-container">
            <h3>Test Visualization</h3>
            <div class="row mb-3">
                <div class="col">
                    <button id="testMap" class="btn btn-info">Test Map Visualization</button>
                </div>
            </div>
            <div class="test-viz" id="testViz"></div>
        </div>
        
        <div class="mt-4">
            <a href="simple-dashboard.html" class="btn btn-lg btn-outline-primary">Go to Simple Dashboard</a>
        </div>
    </div>
    
    <!-- Test Script -->
    <script src="dashboard-test.js"></script>
    
    <script>
        // Function to append log to output
        function log(message, isError = false) {
            const output = document.getElementById('testOutput');
            const p = document.createElement('p');
            p.textContent = message;
            if (isError) {
                p.classList.add('error');
            }
            output.appendChild(p);
            output.scrollTop = output.scrollHeight;
        }
        
        // Test Plotly
        document.getElementById('testPlotly').addEventListener('click', () => {
            document.getElementById('testOutput').innerHTML = '';
            log('Testing Plotly...');
            
            try {
                if (typeof Plotly === 'undefined') {
                    throw new Error('Plotly is not defined');
                }
                log(`Plotly is available (version: ${Plotly.version})`, false);
                log('Plotly test: PASSED', false);
            } catch (error) {
                log(`Error: ${error.message}`, true);
                log('Plotly test: FAILED', true);
            }
        });
        
        // Test Data Loading
        document.getElementById('testData').addEventListener('click', async () => {
            document.getElementById('testOutput').innerHTML = '';
            log('Testing data loading...');
            
            try {
                const data = await window.dashboardTests.testDataLoading();
                log('Data loaded successfully!', false);
                log(`States count: ${data.states.length}`, false);
                log(`First few states: ${data.states.slice(0, 5).join(', ')}`, false);
                log('Data loading test: PASSED', false);
            } catch (error) {
                log(`Error: ${error.message}`, true);
                log('Data loading test: FAILED', true);
            }
        });
        
        // Run All Tests
        document.getElementById('testAll').addEventListener('click', async () => {
            document.getElementById('testOutput').innerHTML = '';
            log('Running all tests...');
            
            try {
                const result = await window.dashboardTests.runAllTests();
                if (result) {
                    log('All tests completed successfully!', false);
                } else {
                    log('Some tests failed. Check console for details.', true);
                }
            } catch (error) {
                log(`Error: ${error.message}`, true);
                log('Test suite failed', true);
            }
        });
        
        // Test Map Visualization
        document.getElementById('testMap').addEventListener('click', async () => {
            document.getElementById('testOutput').innerHTML = '';
            log('Testing map visualization...');
            
            try {
                // Load data first
                const data = await window.dashboardTests.testDataLoading();
                log('Data loaded for visualization test', false);
                
                // Create a simple map visualization
                const locations = data.states;
                const z = data.costs.infant.map(cost => cost || 0);
                const text = locations.map((state, i) => {
                    const cost = z[i];
                    return `${state}: $${cost ? cost.toFixed(2) : 'No data'}`;
                });
                
                const mapData = [{
                    type: 'choropleth',
                    locationmode: 'USA-states',
                    locations: locations,
                    z: z,
                    text: text,
                    hoverinfo: 'text',
                    colorscale: 'Blues',
                    colorbar: {
                        title: 'Cost ($)',
                        thickness: 15
                    }
                }];
                
                const layout = {
                    title: 'Test Map',
                    geo: {
                        scope: 'usa',
                        showlakes: true,
                        lakecolor: 'rgb(255,255,255)'
                    },
                    margin: {
                        l: 0,
                        r: 0,
                        b: 0,
                        t: 30,
                        pad: 0
                    }
                };
                
                Plotly.newPlot('testViz', mapData, layout);
                log('Map visualization created successfully', false);
                log('Map test: PASSED', false);
            } catch (error) {
                log(`Error: ${error.message}`, true);
                log('Map test: FAILED', true);
            }
        });
    </script>
</body>
</html> 